<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Blog</title>
  </head>
  <body>
    <h1>Heading Title</h1>
    <div id='displayArea'></div>
    <script>
      const url = 'http://localhost:4567/api/posts';
      /* -----------------------
          Web API Calls
      -------------------------*/
      function getPosts() {
        return fetch(url)
          .then(posts => posts.json())
      }
      
      function getPost(id) {
        let postUrl = `${url}/${id}`;
        return fetch(postUrl)
          .then(post => post.json());
      }

      function createPost(post) {
        return fetch(url, {
          method: "POST",
          body: JSON.stringify(post)
        }).then(post => post.json());
      }

      /* -----------------------
          Supporting Functions
      -------------------------*/
      // getPosts fetches all posts from the api and
      // returns them as a list of json objects
      function setHeader(text) {
        let heading = document.querySelector('h1');
        heading.textContent = text;
      }

      function displayNav() {
        nav = document.createElement('nav')
        links = [
          {
            linkName: 'Home',
            linkFunction: 'index()'
          },
          { 
            linkName: 'New',
            linkFunction: 'newPost()'
          }
        ];

        links.forEach(link => {
          currentLink = document.createElement('a');
          currentLink.textContent = ` ${link.linkName} `;
          currentLink.setAttribute('href', '#');
          currentLink.setAttribute('onclick', link.linkFunction);
          nav.appendChild(currentLink);
        });
        document.body.prepend(nav);
      }

      function clear() {
        elements = ['nav', 'ul', '#postBody', 'input', 'textarea', 'button', 'label'];
        elements.forEach(element => {
          document.querySelectorAll(element).forEach(item => {
            item.parentNode.removeChild(item);
          });
        });
      }
      
      /* -----------------------
          View Logic
      -------------------------*/

      // index does what is needed to display an index of blog posts
      function index() {
        clear();
        displayNav();
        setHeader('All Posts');
        let myDiv = document.querySelector('#displayArea');
        let myUl = document.createElement('ul');
        myDiv.appendChild(myUl);
        getPosts()
          .then(posts => {
            posts.forEach(post => {
              button = document.createElement('button');
              button.textContent = 'View';
              button.addEventListener('click', () => {
                show(post.id);
              }, false);
              postLi = document.createElement('li');
              postLi.textContent = post.title + ' ';
              postLi.appendChild(button);
              myUl.appendChild(postLi);
            });
          })
      }

      index();

      // show takes a post id, and does what is needed to show a single blog post
      function show(id) {
        clear();
        displayNav();
        getPost(id).then(post => {
          setHeader(post.title);
          postBody = document.createElement('d');
          postBody.setAttribute('id', 'postBody');
          postBody.textContent = post.body;
          displayArea.appendChild(postBody);
        });
      }

      // new does what is needed to show inputs for a new blog post
      function newPost() {
        clear();
        displayNav();
        setHeader('New Post');
        titleInput = document.createElement('input');
        titleInput.setAttribute('name', 'title');
        titleLabel = document.createElement('label')
        titleLabel.setAttribute('for', 'title');
        titleLabel.textContent = 'title: ';
        titleLabel.appendChild(titleInput);

        bodyInput = document.createElement('textarea');
        bodyInput.setAttribute('name', 'body');
        bodyInput.setAttribute('rows', '25');
        bodyInput.setAttribute('cols', '100');
        bodyLabel = document.createElement('label')
        bodyLabel.setAttribute('for', 'body');
        bodyLabel.textContent = 'body: ';
        bodyLabel.appendChild(bodyInput);

        submitButton = document.createElement('button');
        submitButton.textContent = 'create';
        submitButton.addEventListener('click', () => {
          post = {
            title: titleInput.value,
            body: bodyInput.value,
          };
          createPost(post).then(post => show(post.id));
        }, false);


        displayArea.appendChild(titleLabel);
        displayArea.appendChild(bodyLabel);
        displayArea.appendChild(submitButton);
      }

      // update takes a post id, does what is needed to update the post, then 'redirects' to show
      function update(id) {

      }

      // destroy takes a post id, does what is needed to delete the post, then 'redirects' to index
      function destroy(id) {

      }
    </script>
  </body>
</html>
